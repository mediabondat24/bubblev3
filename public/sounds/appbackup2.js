var array_doa = [
    "tahun ini bisa umroh","rezekinya lancar","dijauhkan dari marabahaya","suatu saat nanti punya usaha koskosan","tahun ini kebeli mobil","semakin kuat dalam menghadapi kehidupan","mendapat rezeki yang melimpah","selalu bahagia bersama pasangan kamu","tahun ini lebih hoki lagi","selalu dilimpahkan kebahagiaan","bisa umrohkan orang tua",
    "ditahun ini semua impianmu terwujud","taun depan punya rumah baru","besok ada yang ngajak jalan","segera mendapatkan apa yang kamu impikan","hari ini ada yang traktir","tahun 2024 lebih baik lebih bahagia","diberikan kesehatan dan kekuatan","dilancarkan usahanya","diberikan keberuntungan dan keberkahan","selalu bahagia bersama dirinya",
    "bulan depan punya motor baru","naik gaji","minggu depan punya iPhone","besok ada yang ngasih hadiah","menjadi orang yang sukses","kebeli sawah berhektarhektar","segera dapat kerjaan lebih baik","bisa jalan-jalan keluar negeri","bulan depan ada yang ngajak traveling","minggu depan kebeli sekupi","segera punya hape baru",
    "apayang dicitacitakan bisa segera tercapai","besok ada yang ngajak hiling","segera punya sepatu baru","besok diangkat jadi sodara RafiAhmad","diberikan rizki yang melimpah","selalu dipertemukan dengan orang baik","selalu dicintai pasangan","besok ada yang ngajak liburan","diberikan kemudahan segala urusannya","makin lancar rezekinya",
    "lelahmu menjadi lillah","besok ada yang ngajak ngabuburit","ada yang ngasih THR","suatu saat jadi sultan","suatu saat nanti jadi pengusaha sukses","kehidupanmu menjadi lebih sukses lagi","suatu saat nanti bisa merasakan apa yang RafiAhmad rasakan","panjang umur dan sehat selalu","kebeli tanah berhektarhektar",
    "suatu saat nanti punya usaha cucian mobil","suatu saat nanti punya rumah mewah","hutangmu ada yang lunasi","besok yang ngajak shoping","suatu saat nanti punya mobil alpard","dilancarkan usaha dan aktivitasnya","punya kontrakan 10 pintu","diberikan keturunan yg soleh dan solehah","selalu dikelilingi orang-orang baik dan tulus",
    "mendapatkan pekerjaan yang membahagiakan dan memuaskan","diberikan kesehatan mental yang baik","suatu saat bisa berkeliling dunia","memiliki kehidupan yang penuh syukur dan berkah","mendapatkan teman yang bisa diajak berbagi suka dan duka","mampu membangun keluarga yang harmonis dan bahagia","mendapatkan peningkatan karier yang lebih baik",
    "selalu diberi kelancaran dalam berbisnis","suatu saat nanti memiliki yayasan amal","rezeki yang selalu berkecukupan dan cukup untuk berbagi","selalu diberikan ketenangan hati dalam setiap masalah","mendapatkan promosi di tempat kerja","selalu dilindungi dalam setiap perjalanan","diberikan kesempatan untuk belajar ilmu agama lebih dalam",
    "selalu dimudahkan dalam segala urusan keuangan","mampu membahagiakan keluarga dan orang tua","selalu diberi kekuatan untuk membantu sesama","menjadi pribadi yang lebih sabar dan penyayang","dijauhkan dari segala bentuk kecelakaan dan bencana","selalu diberkahi dengan kesehatan tubuh dan jiwa","diberikan kesempatan beribadah dengan khusyuk",
    "mendapatkan rezeki yang tak disangka-sangka","selalu dilimpahkan kedamaian dalam rumah tangga","mampu menjadi orang yang selalu rendah hati","selalu diberi jalan keluar dalam setiap kesulitan","menjadi panutan dan inspirasi bagi orang lain","selalu dikelilingi cinta dan kasih sayang","diberikan kemampuan untuk mendidik anak-anak dengan baik",
    "selalu diberi petunjuk dalam menjalani kehidupan","mampu menjalankan bisnis yang sukses dan berkah","mendapatkan pasangan yang setia dan penuh perhatian","selalu dijauhkan dari rasa iri dan dengki","selalu bisa memberi manfaat bagi banyak orang","diberi kemampuan mengontrol emosi dan ego","mampu menjalani hidup yang penuh kesederhanaan",
    "diberikan rezeki halal yang melimpah","selalu dalam lindungan Allah SWT dalam setiap langkah","mendapatkan kesempatan untuk berbakti lebih kepada orang tua","suatu saat nanti memiliki tanah dan kebun sendiri","selalu menjadi sumber kebahagiaan bagi orang lain","dijauhkan dari segala bentuk kesialan","diberi kesempatan untuk memperbaiki diri setiap hari",
    "mendapatkan kemudahan dalam membayar hutang","dijauhkan dari teman-teman yang membawa pengaruh negatif","diberikan kelancaran dalam menghafal ayat-ayat suci","selalu disayangi oleh orang-orang di sekitar","mampu menjaga hubungan yang harmonis dengan keluarga","selalu diberi kepercayaan dalam setiap tanggung jawab",
    "diberikan kemudahan dalam menyelesaikan pekerjaan dan tanggung jawab"
  ];

  var array_sambutan = [
    "yang tercinta", "yang suka ngambek","yang lagi pengen jajan","yang kuat  kokoh dan terpercaya","yang kalau mandi sekali sehari","yang terindah dan tersayang", "yang sangat lucu", "yang sangat imut", "yang super cakep","yang masih jomblo haha","yang selalu dimanja nenek","yang selalu merindukan dia",
    "yang mempesona", "yang sedikit agak galak","yang suka sama host","yang jutek banget","yang lagi males ngomong" ,"yang mungil dan lucu","yang kalau lagi seneng suka lupain dia", "yang baik hati dan tidak sombong", "yang pintar merayu","yang saat ini sedang buka tiktok","kamu kemana aja?","yang citacitanya jadi orang kaya",
    "yang terhebat", "yang menawan nan rupawan", "yang sungguh aduhai","yang sedang menunggu jodoh","situkang bucin","yang masih suka ngompol","yang super seksi", "yang sangat cerdas","yang hanya ingin disayangi","yang selalu nurut apa kata orang tua","situkang gosting","yang hobinya tidur mulu","yang suka kabur kalau ditagih hutang",
    "yang baik hati","yang kalau makan bakso 2 mangkok","yang kalau tidur masih dikelonin", "yang cabi", "yang gemoy", "yang manis", "yang tersayang","yang punya hati yang tulus","yang merindukan dia dan dirinya","yang suka ngegosip","yang pinter ngegombal","jagon mamah",
    "yang super hebat","yang sedang memikirkan seseorang", "yang rajin menabung", "yang kalau makan ga cukup 2 piring","yang sopan dan santun","yang ingin punya pacar","yang masih cinta sama mantan","yang ingin diperhatikan","yang jarang mandi","yang masih sendiri","yang alergi kalau ga punya uang",
    "kesayangan mamah","yang lagi laper", "idaman mertua","kesayangan papah","yang sedang memikirkan masa depan", "kesayangan pacar","yang selalu galau","sipenakluk cinta","yang selalu merindu","yang masih kepoin mantan","yang punya kapal pesiar","bolehkan pinjem seratus","yang hobinya jajan seblak",
    "kesayangan mantan","yang sedang galau", "kesayangan keluarga","siraja gombal","yang kalau jajan suka lupa bayar", "yang tangguh dan kuat","yang selalu tersakiti","yang pinter ngomong","yang selalu gabut","yang selalu memaafkan","situkang makan","yang masih suka sama mantan",
    "yang rajin dan pandai","kesayangan nene","yang manja","yang baik hati","yang dermawan","yang dirindukan","yang dicintai umat manusia","yang cakep ga ada obat","pinjem seratus dulu bisa kali","yang belum mandi dari tadi pagi","yang rajin ibadah","kembanggan orang tua",
    "yang mageran","yang kalau makan 3 ngaku 2","yang marahmarah terus","yang disayangi pacar","kamu apa kabar?","yang ingin kawin lagi","yang suka jajan sembarangan","yang selalu bahagia"," yang cantiknya kebangetan","yang suka jajan sembarangan","yang sedang memikirkan aku","yang rajin bekerja",
    "yang selalu nyari colokan kalau baterai low","yang tiap buka dompet selalu kaget","yang pengen liburan tapi mager keluar rumah","yang tiap malam mingguan nonton film","yang ngakunya bisa masak tapi cuma mie instan","yang selalu bilang 'bentar lagi' tapi kelamaan","yang suka kepoin medsos mantan",
    "yang tiap lihat postingan makan langsung lapar","yang kalau makan pakai saus banyak banget","yang sering bilang 'besok mulai nabung'","yang tiap liburan pengennya tidur","yang suka bilang 'nanti aja' kalau ditagih kerjaan","yang kalau beli baju harus diskon","yang selalu update story tiap hari",
    "yang paling cerewet kalau minta foto ulang","yang ngakunya pinter tapi suka bingung","yang nggak bisa lepas dari cemilan","yang tiap pagi ngeluh ngantuk","yang selalu bawa skincare kemana-mana","yang hobinya ngegalauin hidup","yang tiap kali selfie ambil 50 foto","yang suka bilang 'aku laper' tiap jam",
    "yang ngaku-ngaku jago masak","yang paling susah bangun pagi","yang kalau ada masalah bilangnya 'yaudah lah'","yang tiap malam stalking orang","yang suka koleksi parfum tapi pakainya satu","yang kalau ngantuk suka ngigo","yang sering lupa bawa payung","yang ngakunya benci hujan tapi suka nyanyi di bawah hujan",
    "yang paling jago scroll medsos","yang suka tiba-tiba galau","yang kalau weekend maunya di rumah aja","yang nggak bisa tahan lihat makanan enak","yang tiap hari bilang 'males banget'","yang selalu bawa tisu kemana-mana","yang tiap ketemu teman bilang 'kangen banget'","yang suka update foto makanan",
    "yang tiap nonton film pasti nangis","yang selalu bilang 'gue diet' tapi makan terus","yang hobinya download aplikasi gratis","yang paling semangat kalau ada gratisan","yang suka bilang 'mager banget'","yang tiap hari bilang 'aduh capek banget'","yang suka ketawa sendirian lihat chat","yang selalu bawa power bank gede",
    "yang kalau ke mall paling hobi window shopping","yang suka main game sampai lupa waktu","yang selalu bilang 'ini terakhir' saat makan","yang hobinya screenshot chat orang","yang kalau lihat drama pasti ikut marah-marah","yang suka lupa bawa kacamata","yang paling jago bikin status galau",
    "yang selalu bawa hand sanitizer kemana-mana","yang kalau makan pedes nangis","yang kalau selfie pasti pake filter","yang tiap ketemu bilang 'kangen banget'","yang kalau nonton konser paling depan","yang paling ribet urusan outfit","yang tiap lihat promo langsung checkout","yang ngakunya low budget tapi belanja terus",
    "yang suka ketawa ngakak kalau lihat video lucu","yang paling jago bikin meme","yang suka bawa bekal nasi kotak kemana-mana","yang kalau ketawa kenceng banget","yang tiap malam begadang scroll timeline","yang suka banget minum kopi","yang tiap ngumpul selalu cerita yang sama","yang nggak bisa jauh dari air putih",
    "yang tiap buka kulkas nyari cemilan","yang suka lupa naruh HP","yang kalau belanja nggak pernah cukup satu kantong","yang suka pake emot lucu-lucu","yang sering ngeluh nggak punya uang","yang hobi banget cerita panjang","yang kalau pergi keluar lupa bawa jaket","yang suka bilang 'ah pengen tidur' tiap siang",
    "yang sering bilang 'gue kuat kok' padahal rapuh","yang ngakunya hemat tapi suka boros","yang hobinya ngegibah online","yang nggak bisa lihat sesuatu lucu tanpa beli","yang suka ngeluh malas kerja","yang paling jago rebutan diskon","yang kalau dikasih tugas sering lupa","yang ngakunya sibuk padahal gabut",
    "yang tiap hari bilang 'gue capek banget'","yang nggak bisa tidur tanpa peluk bantal","yang suka lihat review makanan online","yang kalau lihat sesuatu mahal langsung galau","yang nggak bisa lepas dari social media","yang suka banget cari diskon online","yang ngakunya pendiam tapi sering curhat panjang",
    "yang paling jago menghindari utang","yang nggak bisa lepas dari es kopi","yang selalu pengen jadi influencer","yang hobinya bikin video lucu","yang selalu bilang 'ah nanti aja'","yang paling banyak nonton video unboxing","yang tiap hari nyari quotes motivasi","yang nggak bisa jauh dari charger",
    "yang kalau makan selalu pesan ekstra sambal","yang sering bilang 'gue nggak posesif kok' tapi ngecek terus","yang kalau denger musik suka joget sendiri","yang hobinya koleksi barang unik","yang tiap ketemu teman lama bilang 'wah makin gendut ya'","yang suka belanja kado buat diri sendiri",
    "yang suka koleksi kaos kaki lucu","yang selalu lupa password akun","yang tiap ada acara bilang 'nggak punya baju'"
];


// This will use the demo backend if you open index.html locally via file://, otherwise your server will be used
let backendUrl = location.protocol === 'file:' ? "https://tiktok-chat-reader.zerody.one/" : undefined;
let connection = new TikTokIOConnection(backendUrl);

// Counter
let viewerCount = 0;
let likeCount = 0;
let diamondsCount = 0;

// These settings are defined by obs.html
if (!window.settings) window.settings = {};

$(document).ready(() => {
    $('#connectButton').click(connect);
    $('#uniqueIdInput').on('keyup', function (e) {
        if (e.key === 'Enter') {
            connect();
        }
    });

    if (window.settings.username) connect();
})


function connect() {
   let uniqueId = window.settings.username || $('#uniqueIdInput').val();
    
    
    if (uniqueId !== '') {
        
        $('#stateText').text('Mohon tunggu jangan klik apapun dulu...');

        connection.connect(uniqueId, {
            enableExtendedGiftInfo: true
        }).then(state => {
            $('#stateText').text(`Berhasil dikoneksikan`);
            scrollToTop();
            tutupmodal();
            masukanpoto();
            aktifSuara("Berhasil di koneksikan ke akun "+uniqueId);
            $("#hide").hide();
            // reset stats
            viewerCount = 0;
            likeCount = 0;
            diamondsCount = 0;
            updateRoomStats();

        }).catch(errorMessage => {
            if(errorMessage=="Error: LIVE has ended"){
                $('#stateText').html("Gagal! tiktok <b>"+uniqueId+"</b> harus dalam keadaan LIVE.");
            }else if(errorMessage=="Error: Request failed with status code 429"){
                $('#stateText').text("Mohon maaf server sedang gangguan silahkan coba beberapa saat lagi. ");
            }else if(errorMessage=="Error: Request failed with status code 500"){
                $('#stateText').text("Mohon maaf server sedang gangguan silahkan coba beberapa saat lagi. ");
            }else{
                $('#stateText').text(errorMessage);
            }

            // schedule next try if obs username set
            if (window.settings.username) {
                setTimeout(() => {
                    connect(window.settings.username);
                }, 30000);
            }
        })

    } else {
        alert('no username entered');
    }
}
// Prevent Cross site scripting (XSS)
function sanitize(text) {
    return text.replace(/</g, '&lt;')
}

function updateRoomStats() {
    $('#roomStats').html(`Viewers: <b>${viewerCount.toLocaleString()}</b> Likes: <b>${likeCount.toLocaleString()}</b> Earned Diamonds: <b>${diamondsCount.toLocaleString()}</b>`)
}

function generateUsernameLink(data) {
    return `<a class="usernamelink" href="https://www.tiktok.com/@${data.uniqueId}" target="_blank">${data.uniqueId}</a>`;
}

function isPendingStreak(data) {
    return data.giftType === 1 && !data.repeatEnd;
}

// Logika untuk menambah chat item dengan foto profil kecil
function addChatItem(color, data, text, summarize='',komen=false) {
    return false;
    const inputString = sanitize(text);
    let container = location.href.includes('obs.html') ? $('.eventcontainer') : $('.chatcontainer');
      
    if (container.find('div').length > 500) {
        container.find('div').slice(0, 200).remove();
    }

    container.find('.temporary').remove();


if(komen==false || komen=="joined" || komen==""){
    var hasil = ""; var awalan = "";
}else{
        aktifSuaraKomen(data.comment);

}
    container.prepend(`
        <div    class=${summarize ? 'temporary' : 'static'}>
         <a target="new" href="javascript:ganti_bg('"${data.profilePictureUrl}"')">
            <img class="miniprofilepicture" src="${data.profilePictureUrl}">
            <span>
                <b>${generateUsernameLink(data)}</b>
                ${awalan} : <span style="color:${color}">${sanitize(text)}</span>  <i>${hasil}</i>
            </span>
        </a>    
        </div>
    `);
}

// Fungsi untuk menambah gambar profil saat gift diberikan, ukuran sesuai diamond
function addGiftItem(data) {
    
}

function moveRandomly(element) {
    const container = document.getElementById("profileContainer");
    const moveInterval = 5000; // Interval perpindahan setiap 5 detik
    const duration = 60000; // Durasi total perpindahan (60 detik)
    const isMobile = window.innerWidth < 768; // Deteksi perangkat mobile berdasarkan lebar layar

    function setInitialPositionWithSlideAndScatter() {
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const elementWidth = element.offsetWidth;
        const elementHeight = element.offsetHeight;

        // Hitung posisi acak di dalam layar
        const randomX = Math.random() * (containerWidth - elementWidth);
        const randomY = Math.random() * (containerHeight - elementHeight);

        // Set posisi awal di pojok kiri atas
        element.style.top = `0px`;
        element.style.left = `0px`;

        // Terapkan kelas animasi dan posisi acak jika di Android
        if (isMobile) {
            element.classList.add('slide-and-scatter');
            setTimeout(() => {
                element.style.top = `${randomY}px`;
                element.style.left = `${randomX}px`;
            }, 10); // Mulai perpindahan setelah elemen di-render

            // Hapus kelas animasi setelah selesai agar bisa melanjutkan gerakan bebas
            setTimeout(() => {
                element.classList.remove('slide-and-scatter');
            }, 1000); // Durasi animasi slide-and-scatter
        } else {
            // Set posisi acak langsung tanpa animasi untuk desktop
            element.style.top = `${randomY}px`;
            element.style.left = `${randomX}px`;
        }
    }

    function setRandomPosition() {
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const elementWidth = element.offsetWidth;
        const elementHeight = element.offsetHeight;

        const randomX = Math.random() * (containerWidth - elementWidth);
        const randomY = Math.random() * (containerHeight - elementHeight);

        element.style.top = `${randomY}px`;
        element.style.left = `${randomX}px`;
    }

    setInitialPositionWithSlideAndScatter();

    const intervalId = setInterval(setRandomPosition, moveInterval);

    setTimeout(() => {
        clearInterval(intervalId);
        element.classList.add('fade-out');
    }, duration);

    setTimeout(() => {
        element.remove();
    }, duration + 2000);
}


// Event handlers
connection.on('roomUser', (msg) => {
    if (typeof msg.viewerCount === 'number') {
        viewerCount = msg.viewerCount;
        updateRoomStats();
    }
})

connection.on('like', (msg) => {
    if (typeof msg.totalLikeCount === 'number') {
        likeCount = msg.totalLikeCount;
        updateRoomStats();
    }

    if (window.settings.showLikes === "0") return;

    if (typeof msg.likeCount === 'number') {
    //    addChatItem('#447dd4', msg, msg.label.replace('{0:user}', '').replace('likes', `${msg.likeCount} likes`),"","joined");
    addBubble("small",msg.profilePictureUrl);
    }
})

// Member join
var urut_sifat=0;
let joinMsgDelay = 0;
connection.on('member', (msg) => {
    if (window.settings.showJoins === "0") return;

    let addDelay = 250;
    if (joinMsgDelay > 500) addDelay = 100;
    if (joinMsgDelay > 1000) addDelay = 0;

    joinMsgDelay += addDelay;
    // gift(msg.profilePictureUrl,msg.nickname,false,false);
    // setTimeout(() => {
        joinMsgDelay -= addDelay;
        // addChatItem('#21b2c2', msg, 'joined', true,"joined");
        addBubble("small",msg.profilePictureUrl);
       
      
        

         
        
        let jumlahElemen = array_sambutan.length;
       if(urut_sifat>=(jumlahElemen-1)){
        urut_sifat=1;
       }else{
        urut_sifat++;
       }
       var sifat =  array_sambutan[urut_sifat];
       var string = msg.nickname;
       var nama = string.replace(/[^a-zA-Z]/g, '');

       var opsi = $("#opsi_suara").val();
       if(opsi==1){
           aktifSuara("halo kak "+nama+" "+sifat,"join");
       }else{
           aktifSuara("selamat bergabung kak "+nama,"join");
       }



    // }, joinMsgDelay);
})

// New chat comment received
connection.on('chat', (msg) => {
    if (window.settings.showChats === "0") return;
  //  gift(msg.profilePictureUrl,msg.nickname,false,false,"chat",msg.comment);
   // addChatItem('', msg, msg.comment,'',true);
     aktifSuaraKomen(msg.comment);
            // openPopupTab(``,`${msg.comment}`);
            addBubble("small",msg.profilePictureUrl);
            addBubble("small",msg.profilePictureUrl);
           
})
// Variabel untuk menyimpan data pemberi gift
let giftGivers = {};

// Fungsi untuk memperbarui data pemberi gift
function updateGiftGivers(data) {
    const { nickname, profilePictureUrl, diamondCount } = data;

    if (!giftGivers[nickname]) {
        giftGivers[nickname] = {
            profilePictureUrl: profilePictureUrl,
            diamondCount: 0
        };
    }

    giftGivers[nickname].diamondCount += diamondCount;

    // Perbarui running teks
    updateRunningText();
}

// Fungsi untuk mendapatkan top 5 pemberi gift
function getTopGivers() {
    return Object.entries(giftGivers)
        .sort(([, a], [, b]) => b.diamondCount - a.diamondCount) // Urutkan berdasarkan diamondCount
        .slice(0, 3) // Ambil top 5
        .map(([nickname, data], index) => ({
            rank: `TOP ${index + 1}`,
            nickname: nickname,
            profilePictureUrl: data.profilePictureUrl,
            diamondCount: data.diamondCount
        }));
}

var colors = ['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'cyan', 'magenta','#2F4F4F','#1E90FF','#CD5C5C','#20B2AA','#C71585','#DDA0DD','#9ACD32'];

// Fungsi untuk memilih warna acak
function getRandomColor() {
    return colors[Math.floor(Math.random() * colors.length)];
}

function updateRunningText() {
    const topGivers = getTopGivers();
    const runningTextContainer = document.querySelector('.running-text');
    
    // Kosongkan kontainer sebelum menambah konten baru
    runningTextContainer.innerHTML = "";
    
    // Tambahkan header teks dengan ukuran font lebih kecil
    const headerText = document.createElement('h2');
    headerText.textContent = 'TOP LIVE BUBBLE FOTO';
    headerText.style.fontSize = '10px'; // Sesuaikan ukuran font sesuai kebutuhan
    headerText.style.marginTop = '85px'; 
    runningTextContainer.appendChild(headerText);

    // Tambahkan setiap top giver
    topGivers.forEach((giver, index) => {
        const giverDiv = document.createElement('div');
        giverDiv.className = `top-giver top-${index + 1}`;

        const giverContentDiv = document.createElement('div');
        giverContentDiv.className = 'top-giver-content';

        const rankSpan = document.createElement('strong');
        rankSpan.className = 'top-giver-rank';
        rankSpan.textContent = `${giver.rank}`;

        const profilePicImg = document.createElement('img');
        profilePicImg.src = giver.profilePictureUrl;
        profilePicImg.style.width = '50px';
        profilePicImg.style.height = '50px';
        profilePicImg.style.borderRadius = '50%';

        // Terapkan border acak pada setiap gambar
        profilePicImg.style.border = '3px solid ' + getRandomColor();
        profilePicImg.style.boxShadow = '0 0 10px ' + getRandomColor();

        const nicknameSpan = document.createElement('span');
        nicknameSpan.textContent = `${giver.nickname} - ${giver.diamondCount} po1ns`;

        giverContentDiv.appendChild(rankSpan);
        giverContentDiv.appendChild(profilePicImg);
        giverContentDiv.appendChild(nicknameSpan);
        giverDiv.appendChild(giverContentDiv);

        runningTextContainer.appendChild(giverDiv);
    });

    // Jika ada top 1, tambahkan gambar profile picture top 1
    if (topGivers.length > 0) {
        const top1Giver = topGivers[0];
        const top1Img = document.createElement('img');
        top1Img.src = top1Giver.profilePictureUrl; // Gambar profile top 1
        top1Img.className = 'top-1-img'; // Terapkan kelas untuk styling gambar

        // Terapkan border acak pada gambar top 1
        top1Img.style.border = '2px solid ' + getRandomColor();
        top1Img.style.boxShadow = '0 0 10px ' + getRandomColor();

        document.body.appendChild(top1Img); // Menambahkan gambar ke body
    }

    // Tampilkan pesan jika belum ada pemberi gift
    if (topGivers.length === 0) {
        runningTextContainer.innerHTML = "Belum ada pemberi gift, ayo jadi yang pertama!";
    }
}


// New gift received
var urut_doa = 0;
connection.on('gift', (data) => {
    if (!isPendingStreak(data) && data.diamondCount > 0) {
        diamondsCount += (data.diamondCount * data.repeatCount);
        updateRoomStats();

    }

    if (window.settings.showGifts === "0") return;
     updateGiftGivers(data);
    // addGiftItem(data);
    // gift(data.profilePictureUrl,data.nickname,true);

    if (!data.repeatEnd) {
        
   
    if(data.diamondCount<=5){
        
        for(i=1;i<=data.diamondCount;i++)
        {
            addBubble("medium",data.profilePictureUrl,data.diamondCount);
            // addBubble("small",data.profilePictureUrl);
            // addBubble("small",data.profilePictureUrl);
        }
        
    
        
        
    }else if(data.diamondCount<=10){
onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        for(i=1;i<=5;i++)
        {
            addBubble("medium",data.profilePictureUrl,data.diamondCount); 
        }
        addBubble("large",data.profilePictureUrl,data.diamondCount); 
         
        for(i=1;i<=5;i++)
        {
            addBubble("small",data.profilePictureUrl);
        }
        musicFile = "/music/meledak.mp3";
    }else if(data.diamondCount<=20){
        bgklip(data.profilePictureUrl,data.diamondCount);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);

        for(i=1;i<=5;i++)
        {
            addBubble("medium",data.profilePictureUrl,data.diamondCount); 
        }
        addBubble("large",data.profilePictureUrl,data.diamondCount); 
        addBubble("large",data.profilePictureUrl,data.diamondCount);  
         
        for(i=1;i<=20;i++)
        {
            addBubble("small",data.profilePictureUrl);
        }
        //supersmall
        addBubble("supersmall",data.profilePictureUrl,data.diamondCount);
        addBubble("supersmall",data.profilePictureUrl,data.diamondCount);
        musicFile = "/music/tangtingtung.mp3";
    }else if(data.diamondCount<=30){
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        for(i=1;i<=5;i++)
        {
            addBubble("supermedium",data.profilePictureUrl,data.diamondCount); 
        }
        
  

        addBubble("large",data.profilePictureUrl,data.diamondCount); 
        addBubble("large",data.profilePictureUrl,data.diamondCount); 
        addBubble("large",data.profilePictureUrl,data.diamondCount); 
        addBubble("large",data.profilePictureUrl,data.diamondCount); 
        addBubble("large",data.profilePictureUrl,data.diamondCount); 

       
    
         
        for(i=1;i<=25;i++)
        {
            addBubble("supersmall",data.profilePictureUrl,data.diamondCount);
        }
        bgklip(data.profilePictureUrl,data.diamondCount);
    }else if(data.diamondCount<=50){
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        for(i=1;i<=10;i++)
        {
             addBubble("large",data.profilePictureUrl,data.diamondCount); 
            addBubble("supermedium",data.profilePictureUrl,data.diamondCount); 
        }
      
        
           
        
        
        for(i=1;i<=40;i++)
        {
 
            addBubble("supersmall",data.profilePictureUrl,data.diamondCount); 
        }
        bgklip(data.profilePictureUrl,data.diamondCount);
         
    }else if(data.diamondCount<=100){
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        for(i=1;i<=20;i++)
        {
            addBubble("supermedium",data.profilePictureUrl,data.diamondCount); 
        }
        
        for(i=1;i<=15;i++)
        {
             addBubble("large",data.profilePictureUrl,data.diamondCount);  
        }
        
        
                
        
        
        for(i=1;i<=40;i++)
        {
            
            addBubble("supersmall",data.profilePictureUrl,data.diamondCount); 
        }
        
         bgklip(data.profilePictureUrl,data.diamondCount);
    }else if(data.diamondCount<=300){
        
          onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);        
                    
        for(i=1;i<=25;i++)
        {
            addBubble("supermedium",data.profilePictureUrl,data.diamondCount); 
        }
        
        for(i=1;i<=20;i++)
        {
             addBubble("large",data.profilePictureUrl,data.diamondCount);  
        }
        
         
        
        
        for(i=1;i<=40;i++)
        {
            addBubble("supersmall",data.profilePictureUrl,data.diamondCount); 
        }
        bgklip(data.profilePictureUrl,data.diamondCount);
         
    }else{
        
         
                    
       for(i=1;i<=35;i++)
        {
            addBubble("supermedium",data.profilePictureUrl,data.diamondCount); 
        }
        
        
                 
        
        for(i=1;i<=30;i++)
        {
             addBubble("large",data.profilePictureUrl,data.diamondCount);  
        }
       
        
        for(i=1;i<=50;i++)
        {
            addBubble("supersmall",data.profilePictureUrl,data.diamondCount); 
        }
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        onGift(data.nickname, data.profilePictureUrl, data.giftPictureUrl, true);
        bgklip(data.profilePictureUrl,data.diamondCount);
    }


   
     

      let jumlahElemen = array_doa.length;
      if(urut_doa>=(jumlahElemen-1)){
        urut_doa=1;
      }else{
        urut_doa++;
      }
      var doa= array_doa[urut_doa];

      var string = data.nickname;
      var nama = string;//.replace(/[^a-zA-Z]/g, '');


      var opsi = $("#opsi_suara").val();
      if(opsi==1){
        aktifSuara("Terimakasih kak "+nama+"  sudah kasih "+data.giftName+" semoga "+doa+".","gift");
      }else{
        aktifSuara("Terimakasih kak "+nama+"  sudah kasih "+data.giftName+" semoga berkah","gift");
      }


          
    




        }     
})

// share, follow
connection.on('social', (data) => {
    if (window.settings.showFollows === "0") return;

    let color = data.displayType.includes('follow') ? '#ff005e' : '#2fb816';
    if(color=='#ff005e'){
        aktifSuara("Terimakasih kak "+data.nickname+"  sudah jadikan aku teman","follow");
        addBubble("small",data.profilePictureUrl);
    }else{
        aktifSuara("Terimakasih kak "+data.nickname+"  sudah sherr","share");
        addBubble("small",data.profilePictureUrl);
    }
 
})

connection.on('streamEnd', () => {
    $('#stateText').text('Stream ended.');

    // schedule next try if obs username set
    if (window.settings.username) {
        setTimeout(() => {
            connect(window.settings.username);
        }, 30000);
    }
})
